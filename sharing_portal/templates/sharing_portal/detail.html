{% extends 'layout/default.html' %}
{% load i18n cms_tags markdown_deux_tags staticfiles pipeline bootstrap3 %}
{% block title %}Sharing Portal | Chameleon Cloud {% endblock %}

{% block styles %}
{{ block.super }}
<link rel="stylesheet" type="text/css" href="{% static 'sharing_portal/artifacts.css' %}">
{% endblock %}

{% block content %}
{# Experiments / [current_exp_title] subheader #}
<ol class="breadcrumb">
  <li>
    <a href="{% url 'sharing_portal:index_all' %}">Artifacts</a>
  </li>
  <li class="active">{{ artifact.title }}</li>
</ol>

<div class="artCatalog">
  <h2 class="artCatalog__title">{{ artifact.title }}</h2>

  <div class="artCatalog__content">
    <div class="artCatalog__actions">
      {% if editable %}
      <a class="btn btn-warning" href="{% url 'sharing_portal:edit' artifact.pk %}">
        <i class="fa fa-edit"></i> Edit
      </a>
      {% endif %}
      {% if artifact.launchable %}
      <a class="btn btn-primary" href="{{ artifact.jupyterhub_link }}" target="_blank">
        Launch with JupyterHub
      </a>
      {% endif %}
      {% if artifact.git_repo %}
      <a class="btn" href="https://github.com/{{ artifact.git_repo }}" target="_blank">
        <i class="fa fa-github"></i>&nbsp;GitHub: {{ artifact.git_repo }}
      </a>
      {% endif %}
    </div>

    <div class="artifactDescription">
      {{ artifact.description|markdown|safe }}
    </div>

    <section>
      <h4>Authors</h4>
      {% for author in artifact.authors.all %}
      <p>{{ author }}</p>
      {% endfor %}
    </section>

    {% if version and version.zenodo_link %}
    <section>
      <h4>Digital Object Identifier (DOI)</h4>
      <a href="{{ version.zenodo_link }}" target="_blank">{{ version.doi }}</a> ({{ version.created_at }})
    </section>
    {% endif %}

    {% if artifact.labels.all %}
    <section>
      <h4>Labels</h4>
      {% for label in artifact.labels.all %}
      <span class="badge">{{ label.label }} </span>
      {% endfor %}
    </section>
    {% endif %}
  </div>

  <div class="artCatalog__sidebar">
    {% if editable %}
    <a class="btn pull-right" href="{% url 'sharing_portal:sync_versions' artifact.pk %}">
      <i class="fa fa-refresh"></i>&nbsp;Sync versions
    </a>
    {% endif %}

    <h4>Versions</h4>
    <ol class="artifactVersion">
    {% for i, v in all_versions %}
      <li class="{% if version == v %}selected{% endif %}">
        <a class="artifactVersion__link" href="{% url 'sharing_portal:detail_version' artifact.pk i %}">
          <span>Version {{ i }}</span>
          <span>{{ v.created_at }}</span>
        </a>
      </li>
    {% endfor %}
    </ol>

    {% if artifact.associated_artifacts.count > 0 %}
    <h4>Associated Artifacts</h4>
    <ul class="artCatalog__associated">
      {% for related_item in artifact.associated_artifacts.all %}
      <li>
        <a href="{% url 'sharing_portal:detail' related_item.pk %}">{{ related_item.title }}</a>
      </li>
      {% endfor %}
    </div>
    {% endif %}

    {% if related_artifacts %}
    <h4>Similar Artifacts</h4>
    <ul class="artCatalog__related">
      {% for related in related_artifacts %}
      <li>
        <a href="{% url 'sharing_portal:detail' related.id %}">{{ related.title }}</a>
        {% for label in related.labels.all %}
        <span class="badge">{{ label.label }}</span>
        {% endfor %}
      </li>
      {% endfor %}
    </ul>
    {% endif %}

  </div>

</div>
{% endblock %}
