(function(e){function t(t){for(var a,n,o=t[0],l=t[1],c=t[2],u=0,p=[];u<o.length;u++)n=o[u],Object.prototype.hasOwnProperty.call(i,n)&&i[n]&&p.push(i[n][0]),i[n]=0;for(a in l)Object.prototype.hasOwnProperty.call(l,a)&&(e[a]=l[a]);d&&d(t);while(p.length)p.shift()();return r.push.apply(r,c||[]),s()}function s(){for(var e,t=0;t<r.length;t++){for(var s=r[t],a=!0,o=1;o<s.length;o++){var l=s[o];0!==i[l]&&(a=!1)}a&&(r.splice(t--,1),e=n(n.s=s[0]))}return e}var a={},i={hardware_catalogue:0},r=[];function n(t){if(a[t])return a[t].exports;var s=a[t]={i:t,l:!1,exports:{}};return e[t].call(s.exports,s,s.exports,n),s.l=!0,s.exports}n.m=e,n.c=a,n.d=function(e,t,s){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},n.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(n.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)n.d(s,a,function(t){return e[t]}.bind(null,a));return s},n.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="";var o=window["webpackJsonp"]=window["webpackJsonp"]||[],l=o.push.bind(o);o.push=t,o=o.slice();for(var c=0;c<o.length;c++)t(o[c]);var d=l;r.push([4,"vendor"]),s()})({"15f0":function(e,t,s){"use strict";function a(e,t){return Object.fromEntries(Object.entries(e).map(([e,s])=>[e,t(s)]))}function i(e,t){return Object.fromEntries(Object.entries(e).map(([e,s])=>[t(e),s]))}s.r(t),s.d(t,"mapValues",(function(){return a})),s.d(t,"mapKeys",(function(){return i}))},"373f":function(e,t,s){"use strict";s("8d2b")},4:function(e,t,s){e.exports=s("afa2")},"53da":function(e,t,s){"use strict";s.r(t),s.d(t,"configureXHR",(function(){return o}));var a=s("d058"),i=s.n(a),r=s("a79c"),n=s.n(r);function o(e){e.defaults.xsrfCookieName="csrftoken",e.defaults.xsrfHeaderName="X-CSRFTOKEN",e.defaults.transformResponse=[(e,t)=>{if(e&&t["content-type"].includes("application/json"))return i()(JSON.parse(e),{deep:!0})}],e.defaults.transformRequest=[(e,t)=>{const s=t["content-type"];if(e&&(!s||s.includes("application/json")))return JSON.stringify(n()(e,{deep:!0}))}],e.defaults.headers["Content-Type"]="application/json"}},6178:function(e,t,s){"use strict";s("d1a0")},"8d2b":function(e,t,s){},afa2:function(e,t,s){"use strict";s.r(t);var a=s("bc3a"),i=s.n(a),r=s("2b0e"),n=function(){var e=this,t=e._self._c;return t("div",[t("div",{staticClass:"row"},[t("div",{staticClass:"col-md-12"},[e.loading?t("div",[e._m(0)]):t("div",[t("div",{directives:[{name:"show",rawName:"v-show",value:"search"===e.panel,expression:"panel === 'search'"}]},[t("HardwareCatalogueFilters",{ref:"filters",attrs:{filteredNodes:e.filteredNodes,allNodes:e.allNodes},on:{filtersChange:e.onFiltersChanged}}),t("button",{staticClass:"btn btn-sm btn-info",on:{click:function(t){return e.changeView("results")}}},[e._v(" View")]),e._v(e._s(" ")+" "),t("button",{staticClass:"btn btn-sm btn-success",attrs:{"data-toggle":"modal","data-target":"#show-reservation"}},[e._v(" Reserve")]),e._v(e._s(" ")+" "),t("button",{staticClass:"btn btn-sm",on:{click:function(t){return e.reset()}}},[e._v("Reset")])],1),t("div",{staticClass:"modal",attrs:{tabindex:"-1",role:"dialog",id:"show-reservation"}},[t("div",{staticClass:"modal-dialog",attrs:{role:"document"}},[t("div",{staticClass:"modal-content"},[e._m(1),t("div",{staticClass:"modal-body"},[t("p",[e._v("Using the Blazar CLI:")]),t("pre",[e._v("openstack reservation lease create \\\n  --reservation type=physical:host,min=1,max=1,resource_properties="+e._s(e.reservationPropertiesJSON)+" \\\n  NAME_OF_LEASE\n                  ")])]),e._m(2)])])]),t("section",{directives:[{name:"show",rawName:"v-show",value:"results"===e.panel,expression:"panel === 'results'"}]},[t("div",{staticClass:"row"},[t("div",{staticClass:"col-md-6"},[t("div",{staticClass:"btn-group"},[t("button",{staticClass:"btn btn-sm",on:{click:function(t){return e.changeView("search")}}},[e._v(" Back ")])])]),t("div",{staticClass:"col-md-6"},[t("div",{staticClass:"form-group"},[t("input",{staticClass:"form-control",attrs:{type:"text",name:"nodeViewSearch",placeholder:"Search by any node properties."},on:{input:e.updateSearch}})])])]),t("div",{staticClass:"row"},[t("div",{staticClass:"col-md-12"},[t("InfiniteScroller",{directives:[{name:"show",rawName:"v-show",value:e.visibleNodes,expression:"visibleNodes"}],attrs:{items:e.visibleNodes},scopedSlots:e._u([{key:"default",fn:function(e){return[t("HardwareDetails",{attrs:{hardware:e.item}})]}}])}),t("div",{directives:[{name:"show",rawName:"v-show",value:!e.visibleNodes,expression:"!visibleNodes"}],staticClass:"alert alert-warning"},[e._v(" Node(s) not found. ")])],1)])])])])])])},o=[function(){var e=this,t=e._self._c;return t("div",{staticClass:"well"},[t("h4",[t("span",{staticClass:"fa fa-refresh fa-spin"}),e._v(" Loading hardware... ")])])},function(){var e=this,t=e._self._c;return t("div",{staticClass:"modal-header"},[t("button",{staticClass:"close",attrs:{type:"button","data-dismiss":"modal","aria-label":"Close"}},[t("span",{attrs:{"aria-hidden":"true"}},[e._v("Ã—")])]),t("h5",{staticClass:"modal-title"},[e._v("Reserve from selection")])])},function(){var e=this,t=e._self._c;return t("div",{staticClass:"modal-footer"},[t("button",{staticClass:"btn btn-secondary",attrs:{type:"button","data-dismiss":"modal"}},[e._v(" Close ")])])}],l=function(){var e=this,t=e._self._c;return t("div",[t("h4",[e._v(" Applied Filters: "),e.activeFilters.length?e._e():t("span",[e._v(" None")]),e._l(e.activeFilters,(function(s){return t("span",{key:s.label},[t("span",{staticClass:"label label-default"},[t("span",{staticClass:"label-text"},[e._v(e._s(s.tagLabel)+" "),t("span",{staticClass:"pseudolink fa fa-times",on:{click:function(t){return e.toggleFilter(s)}}})])]),e._v(e._s(" ")+" ")])}))],2),t("h4",{staticClass:"filter-state"},[t("strong",[e._v(e._s(e.total)+" node"),e.total>1?t("span",[e._v("s")]):e._e()]),e.total<e.maximum?t("span",[e._v(" filtered from "+e._s(e.maximum)+" originally. ")]):e._e()]),t("div",{staticClass:"row"},e._l(e.coarseFilters,(function(s){return t("div",{key:s.label,staticClass:"col col-sm-3"},[t("button",{staticClass:"btn btn-lg btn-primary btn-filter btn-block",attrs:{type:"button",disabled:!s.currentMatches},on:{click:function(t){return e.toggleFilter(s)}}},[s.maxMatches===e.total?t("span",{staticClass:"fa fa-check-square-o"}):e._e(),e._v(" "+e._s(s.label)+" "),s.currentMatches?t("span",[e._v("("+e._s(s.currentMatches)+")")]):e._e()])])})),0),t("div",{staticClass:"row"},e._l(e.simpleCapabilityFilters,(function(s,a){return t("div",{key:a,staticClass:"col col-sm-2"},[t("strong",[e._v(e._s(a))]),e._l(s,(function(s){return t("div",{key:s.label,staticClass:"checkbox"},[t("label",[t("input",{attrs:{type:"checkbox",name:a,disabled:!s.currentMatches},domProps:{value:s.label,checked:s.active},on:{change:function(t){return e.toggleFilter(s)}}}),e._v(" "+e._s(s.label)+" ("+e._s(s.currentMatches)+")")])])}))],2)})),0),t("div",{staticClass:"row"},[t("div",{staticClass:"col-md-12"},[t("h4",[t("a",{attrs:{role:"button"},on:{click:function(t){return e.toggleAdvancedFilters()}}},[t("span",{staticClass:"fa",class:{"fa-minus":e.showAdvanced,"fa-plus":!e.showAdvanced}}),e._v(" Advanced Filters")])]),e.showAdvanced?t("div",e._l(e.advancedCapabilityFilters,(function(s,a){return t("div",{key:a,staticClass:"filter-section"},[t("h5",{staticClass:"bg-success"},[e._v(e._s(a))]),t("div",{staticClass:"row"},e._l(s,(function(s,i){return t("div",{key:i,staticClass:"col-md-2"},[t("strong",[e._v(e._s(i))]),e._l(s,(function(s){return t("div",{key:s.label,staticClass:"checkbox"},[t("label",[t("input",{attrs:{type:"checkbox",name:a,disabled:!s.currentMatches},domProps:{value:s.label,checked:s.active},on:{change:function(t){return e.toggleFilter(s)}}}),e._v(" "+e._s(s.label)+" ("+e._s(s.currentMatches)+")")])])}))],2)})),0)])})),0):e._e()])]),t("h4",{staticClass:"filter-state"},[t("strong",[e._v(e._s(e.total)+" node"),e.total>1?t("span",[e._v("s")]):e._e()]),e.total<e.maximum?t("span",[e._v(" filtered from "+e._s(e.maximum)+" originally. ")]):e._e()])])},c=[],d=s("9607"),u=s.n(d),p=s("a4d6"),f=s("3043"),h=s("b500");function v(e,t,s){const a=s&&s.constraint;if("string"===typeof t){const e=t;t=t=>({result:u.a.apply(e,t),constraint:a})}const i=`${s&&s.tagPrefix||""}${e}`;return{label:e,tagLabel:i,filterFn:t,active:!1,maxMatches:0,currentMatches:0}}function m(e,t){return isNaN(parseInt(e))||isNaN(parseInt(t))?e>t?1:-1:parseInt(e)>parseInt(t)?1:-1}function b(e,t,s){const a=new Set(u.a.apply(e,t));return Array.from(a).sort(m).map(t=>{const a=e.split("."),i=a.pop(),r="string"===typeof t?`"${t}"`:t;let n=null;return e.includes("parent")||(n=["==","$"+a.slice(1).concat(i).map(p["a"]).join("."),t]),v(t,`.{${a.join(".")}.${i} === ${r}}`,{constraint:n,...s})})}function g(e,t,s){const a=new Set(t.map(e));return Array.from(a).sort(m).map(t=>v(t,s=>s.filter(s=>e(s)===t),s))}function y(e,t,s){const a=u.a.apply(e,t),i=new Set(Array.prototype.concat.apply([],a.map(Object.keys)));s&&s.ignore&&s.ignore.forEach(e=>i.delete(e));const r={};return i.forEach(s=>{r[Object(f["a"])(s)]=b(`${e}.${s}`,t,{tagPrefix:s+": "})}),r}var _={props:{filteredNodes:Array,allNodes:Array},data(){const e=e=>Object.fromEntries(Object.entries(e).map(([e,{capability:t,tagPrefix:s}])=>{const a="function"===typeof t?g:b;return[e,a(t,this.allNodes,{tagPrefix:s})]})),t=b(".nodeType",this.allNodes),s=e(h["simpleCapabilities"]),a=Object.fromEntries(Object.entries(h["advancedCapabilities"]).map(([t,{discover:s,custom:a}])=>{const i=s?y(s.prefix,this.allNodes,{ignore:s.ignore}):{},r=a?e(a):{};return[t,{...i,...r}]}));return{showAdvanced:!1,coarseFilters:t,simpleCapabilityFilters:s,advancedCapabilityFilters:a}},watch:{filteredNodes:function(){this.updateFilterCounts()}},computed:{allFilters(){let e=Array.from(this.coarseFilters);e=e.concat(...Object.values(this.simpleCapabilityFilters));for(const t in this.advancedCapabilityFilters)e=e.concat(...Object.values(this.advancedCapabilityFilters[t]));return e},activeFilters(){return this.allFilters.filter(({active:e})=>e)},maximum(){return this.allNodes.length},total(){return this.filteredNodes.length}},methods:{reset(){for(const e of this.allFilters)e.active=!1;this.$emit("filtersChange",[])},toggleFilter(e){e.active=!e.active,this.$emit("filtersChange",this.activeFilters.map(({filterFn:e})=>e))},toggleAdvancedFilters(){this.showAdvanced=!this.showAdvanced},getFilterResult(e,t){let s=e.filterFn(t);return Array.isArray(s)?s:s.result},updateFilterCounts(){const e=this.allNodes.length>this.filteredNodes.length;for(const t of this.allFilters)t.currentMatches=e?this.getFilterResult(t,this.filteredNodes).length:t.maxMatches}},mounted(){for(const e of this.allFilters)e.currentMatches=e.maxMatches=this.getFilterResult(e,this.allNodes).length}},C=_,w=(s("6178"),s("0c7c")),N=Object(w["a"])(C,l,c,!1,null,"16816d7b",null),x=N.exports,F=function(){var e=this,t=e._self._c;return t("div",{staticClass:"hardware-details"},[t("h4",{staticClass:"node-header"},[t("a",{attrs:{href:"node/sites/"+e.hardware.parent.parent.uid+"/clusters/"+e.hardware.parent.uid+"/nodes/"+e.hardware.uid}},[e._v(e._s(e.hardware.nodeName||e.hardware.uid))]),t("span",{staticClass:"label label-default node-type"},[e._v(e._s(e.hardware.nodeType))])]),t("section",[t("div",{staticClass:"row"},e._l(e.simpleCapabilities,(function(s,a){return t("div",{key:a,staticClass:"col-md-3"},[t("strong",[e._v(e._s(a)+": ")]),e._v(e._s(s)+" ")])})),0),e._l(e.advancedCapabilities,(function(s,a){return t("div",{key:a,staticClass:"row"},[t("div",{staticClass:"col-md-12"},[t("h5",{staticClass:"bg-success"},[e._v(e._s(a))])]),e._l(s,(function(s,a){return t("div",{key:a,staticClass:"col-md-3"},[t("strong",[e._v(e._s(a)+": ")]),e._v(e._s(s)+" ")])}))],2)}))],2)])},k=[],O=s("15f0"),j={props:{hardware:Object},data(){return{simpleCapabilities:Object(O["mapValues"])(h["simpleCapabilities"],({capability:e})=>this.resolveCapability(e)),advancedCapabilities:Object(O["mapValues"])(h["advancedCapabilities"],({discover:e,custom:t})=>{let s={};return e&&(s={...s,...Object(O["mapKeys"])(u.a.apply(e.prefix,this.hardware)[0]||{},f["a"])}),t&&(s={...s,...Object(O["mapValues"])(t,({capability:e})=>this.resolveCapability(e))}),s})}},methods:{resolveCapability(e){return"function"===typeof e?e(this.hardware):u.a.apply(e,this.hardware)[0]}}},S=j,P=(s("373f"),Object(w["a"])(S,F,k,!1,null,"d0545d76",null)),A=P.exports,M=function(){var e=this,t=e._self._c;return t("div",[e._l(e.visibleItems,(function(s,a){return t("div",{key:a+s.uid},[e._t("default",null,{item:s})],2)})),e.numRemaining?t("div",[t("p",{staticClass:"text-center"},[e._v("("+e._s(e.numRemaining)+" more)")])]):e._e()],2)},I=[],R={props:{items:Array},data(){const e=this.items.slice(0,10);return{visibleItems:e,keyNonce:""}},computed:{numRemaining(){return this.items.length-this.visibleItems.length}},watch:{items(){this.visibleItems=this.items.slice(0,10),this.keyNonce=(new Date).getTime()}},methods:{onScroll(e){this.$el.getBoundingClientRect().bottom<window.innerHeight&&(this.visibleItems=this.items.slice(0,this.visibleItems.length+10))}},mounted(){window.addEventListener("scroll",this.onScroll)},destroyed(){window.removeEventListener("scroll",this.onScroll)}},T=R,V=Object(w["a"])(T,M,I,!1,null,null,null),$=V.exports;function D(e,t){const s=e.find(({rel:e})=>e===t);return s?s.href.replace("/","")+".json":""}function E(e){return Array.prototype.concat.apply([],e)}function L(e){return t=>(Array.isArray(t)||(t=[t]),Promise.all(t.map(t=>{const s=t.items;return s?Promise.all(s.map(t=>{const s=D(t.links,e);return s?i.a.get(s).then(e=>{const s=e.data;return s.items=s.items.map(e=>(e.parent=t,e)),s}):(console.error(`No ${e} found for item`,t),[])})).then(E):(console.error("Could not find items in response",t),[])})).then(E))}var z={components:{HardwareCatalogueFilters:x,HardwareDetails:A,InfiniteScroller:$},data(){return{loading:!0,panel:"search",searchQuery:"",allNodes:[],filteredNodes:[],visibleNodes:[],reservationProperties:[]}},computed:{reservationPropertiesJSON(){return JSON.stringify(this.reservationProperties)}},methods:{async fetchNodes(){const e=t=>Object.values(t).reduce((t,s)=>("object"===typeof s&&null!==s?t=t.concat(e(s)):"string"===typeof s&&t.push(s),t),[]);this.loading=!0,this.allNodes=await i.a.get("sites.json").then(({data:e})=>e).then(L("clusters")).then(L("nodes")).then(e=>E(e.map(({items:e})=>e))).then(t=>t.map(t=>(t._searchIndex=e(t).join("|").toLowerCase(),t))),this.visibleNodes=this.filteredNodes=this.allNodes,this.loading=!1},changeView(e){this.panel=e},updateVisibleNodes(){this.visibleNodes=this.filteredNodes.filter(e=>!this.searchQuery||e._searchIndex.includes(this.searchQuery.toLowerCase()))},reset(){this.$refs.filters.reset()},onFiltersChanged(e){if(!e)return void(this.filteredNodes=this.allNodes);let t=this.allNodes;const s=[];let a=!0;for(const i of e){let e=i(t),r=null;Array.isArray(e)||(r=e.constraint,e=e.result),t=e,r?s.push(r):a=!1}a?s.length<=1?this.reservationProperties=s.length?s[0]:[]:this.reservationProperties=["and",...s]:this.reservationProperties=["in","$node_name",t.map(({name:e,nodeName:t})=>e||t)],this.filteredNodes=t,this.updateVisibleNodes()},updateSearch(e){this.searchQuery=e.target.value,this.updateVisibleNodes()}},mounted(){this.fetchNodes()}},B=z,H=Object(w["a"])(B,n,o,!1,null,"97789ad0",null),J=H.exports,G=s("53da");Object(G["configureXHR"])(i.a),new r["a"]({render:e=>e(J)}).$mount("#app")},b500:function(e,t,s){"use strict";s.r(t),s.d(t,"simpleCapabilities",(function(){return n})),s.d(t,"advancedCapabilities",(function(){return o}));const a=["v100","p100","m40","k80","rtx 6000"],i=1073741824,r={"< 200GB":[0,200*i],"200-400GB":[200*i,400*i],"400GB-1TB":[400*i,1e3*i],">1TB":[1e3*i,Number.POSITIVE_INFINITY]},n={Site:{capability:".parent.parent.uid"},"Platform Type":{capability:".architecture.platformType"},"# CPUS":{capability:".architecture.smpSize",tagPrefix:"CPUS: "},"# Threads":{capability:".architecture.smtSize",tagPrefix:"Threads: "},"RAM Size":{capability:".mainMemory.humanizedRamSize",tagPrefix:"RAM: "},"Total Storage":{capability(e){const t=e.storageDevices.reduce((e,t)=>e+t.size,0);for(const s in r)if(t>=r[s][0]&&t<r[s][1])return s;return"Unknown"},tagPrefix:"Storage: "}},o={Processor:{discover:{prefix:".processor"}},Placement:{discover:{prefix:".placement",ignore:["node"]}},GPU:{discover:{prefix:".gpu"}},FPGA:{discover:{prefix:".fpga"}},"Network Devices":{custom:{"# Active Devices":{capability({networkAdapters:e}){return e.filter(({enabled:e})=>e).length},tagPrefix:"Networks: "}},discover:{prefix:".networkAdapters",ignore:["device","enabled","interface","mac","rate","driver","management","bridged","mounted","guid","version"]}},SSD:{custom:{SSD:{capability({storageDevices:e}){return e.some(({model:e,mediaType:t})=>e.toLowerCase().includes("ssd")||"ssd"===(t||"").toLowerCase())?"Yes":"No"}}},discover:{prefix:".storageDevices",ignore:["device","humanizedSize","interface","size","rev","mediaType","driver"]}},NVMe:{custom:{NVMe:{capability({storageDevices:e}){return e.some(({driver:e,interface:t})=>"nvme"===e||"pcie"===(t||"").toLowerCase())?"Yes":"No"},tagPrefix:"NVMe: "}}},RDMA:{custom:{InfiniBand:{capability({infiniband:e}){return e?"Yes":"No"}},GPUDirect:{capability({infiniband:e,gpu:t}){return e&&t&&t.gpuModel&&t.gpuModel.toLowerCase()in a?"Yes":"No"}},NVMEoF:{capability({infiniband:e,storageDevices:t}){let s=e,a=t.some(({driver:e,interface:t})=>"nvme"===e||"pcie"===(t||"").toLowerCase());return s&&a?"Yes":"No"}}}}}},d1a0:function(e,t,s){}});