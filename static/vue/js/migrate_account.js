(function(t){function e(e){for(var s,n,o=e[0],c=e[1],l=e[2],d=0,g=[];d<o.length;d++)n=o[d],Object.prototype.hasOwnProperty.call(i,n)&&i[n]&&g.push(i[n][0]),i[n]=0;for(s in c)Object.prototype.hasOwnProperty.call(c,s)&&(t[s]=c[s]);u&&u(e);while(g.length)g.shift()();return r.push.apply(r,l||[]),a()}function a(){for(var t,e=0;e<r.length;e++){for(var a=r[e],s=!0,o=1;o<a.length;o++){var c=a[o];0!==i[c]&&(s=!1)}s&&(r.splice(e--,1),t=n(n.s=a[0]))}return t}var s={},i={migrate_account:0},r=[];function n(e){if(s[e])return s[e].exports;var a=s[e]={i:e,l:!1,exports:{}};return t[e].call(a.exports,a,a.exports,n),a.l=!0,a.exports}n.m=t,n.c=s,n.d=function(t,e,a){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:a})},n.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var a=Object.create(null);if(n.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)n.d(a,s,function(e){return t[e]}.bind(null,s));return a},n.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="";var o=window["webpackJsonp"]=window["webpackJsonp"]||[],c=o.push.bind(o);o.push=e,o=o.slice();for(var l=0;l<o.length;l++)e(o[l]);var u=c;r.push([2,"vendor"]),a()})({"1a3f":function(t,e,a){"use strict";a("c1e3")},2:function(t,e,a){t.exports=a("a697")},a697:function(t,e,a){"use strict";a.r(e);var s=a("bc3a"),i=a.n(s),r=a("d058"),n=a.n(r),o=a("a79c"),c=a.n(o),l=a("2b0e"),u=function(){var t=this,e=t._self._c;return e("div",{staticClass:"row"},[e("div",{staticClass:"col-md-4"},[e("div",{staticClass:"panel panel-default"},[t._m(0),t.loading?e("div",{staticClass:"empty"},[e("p",[t._v("Loading your user…")])]):e("div",{staticClass:"userProject"},[e("div",{staticClass:"userProject_heading"},[e("span",{staticClass:"title"},[t._v(t._s(t.user.name))]),e("button",{staticClass:"migrateButton btn",class:{"btn-default":t.user.migratedAt,"btn-primary":!t.user.migratedAt},on:{click:function(e){return t.migrateUser()}}},[t.user.migratedAt?e("span",[t._v("Re-run migration")]):e("span",[t._v("Migrate")])])])])]),e("div",{staticClass:"panel panel-default"},[t._m(1),t.loading?e("div",{staticClass:"empty"},[e("p",[t._v("Loading your projects…")])]):e("div",[e("ul",{staticClass:"userProjects"},t._l(t.projects,(function(a){return e("li",{key:a.chargeCode,staticClass:"userProject"},[e("div",{staticClass:"userProject_heading"},[e("span",{staticClass:"title"},[t._v(t._s(a.name))]),e("button",{staticClass:"migrateButton btn",class:{"btn-default":a.migratedAt,"btn-primary":!a.migratedAt},on:{click:function(e){return t.migrateProject(a.chargeCode)}}},[a.migratedAt?e("span",[t._v("Re-run migration")]):e("span",[t._v("Migrate")])])]),a.migratedAt?e("div",[e("span",{staticClass:"badge badge-success"},[t._v("Migrated")]),e("span",[t._v("on "+t._s(t.migratedAt(a)))])]):t._e()])})),0)])])]),e("div",{staticClass:"col-md-8"},[e("div",{staticClass:"panel panel-default",class:{"panel-success":t.migrationSucceeded,"panel-danger":t.migrationFailed}},[t.migrationStatus?e("div",{staticClass:"panel-heading"},[e("h4",{staticClass:"panel-title"},[t.migrationSucceeded?e("span",[t._v("Migration completed")]):t.migrationFailed?e("span",[t._v("Migration failed")]):e("span",[t._v("Migration in progress")])])]):t._e(),t.migrationStatus?e("div",{staticClass:"migrationStatus"},[e("div",{staticClass:"progress"},[e("div",{staticClass:"progress-bar",class:{"progress-bar-success":t.migrationSuccess,"progress-bar-danger":t.migrationFailed},style:{width:t.migrationPercentage+"%"}})]),e("h4",[t._v("Log")]),e("pre",[t._v(t._s(t.migrationStatus.messages.join("\n")))])]):e("div",{staticClass:"empty lalign"},[t._m(2)])])])])},d=[function(){var t=this,e=t._self._c;return e("div",{staticClass:"panel-heading"},[e("h4",{staticClass:"panel-title"},[t._v("Your user")])])},function(){var t=this,e=t._self._c;return e("div",{staticClass:"panel-heading"},[e("h4",{staticClass:"panel-title"},[t._v("Projects")])])},function(){var t=this,e=t._self._c;return e("div",[e("p",[t._v("Select a user or project to start (or re-run) a migration.")]),e("p",[t._v(" A "),e("strong",[t._v("user migration")]),t._v(" ensures any SSH keypairs uploaded in the past are transferred over to your new account. ")]),e("p",[t._v(" A "),e("strong",[t._v("project migration")]),t._v(" ensures any disk images or snapshots associated with the project are transferred to the new account. Disk images and snapshots will still be accessible via the old account, so this is non-destructive. Any member of the project can initiate a migration. ")])])}],g={data(){return{loading:!0,user:{},projects:[],activeMigrations:new Map,migrationStatus:null}},computed:{migrationSucceeded(){return this.migrationStatus&&"SUCCESS"===this.migrationStatus.state},migrationFailed(){return this.migrationStatus&&"FAILURE"===this.migrationStatus.state},migrationPercentage(){const{progressPct:t=1}=this.migrationStatus||{};return t}},methods:{migratedAt(t){return new Date(t.migratedAt).toLocaleString("en-US")},refresh(){i.a.get("/api/user/migrate/status/").then(t=>{const{user:e,projects:a}=t.data;this.projects=a,this.user=e}).catch(t=>{this.errored=!0}).finally(()=>this.loading=!1)},startMigration(t,e,a={}){const s=()=>setInterval(this.pollMigration.bind(this,t),3e3);if(this.clearPollers(),this.activeMigrations.has(t)){const e=this.activeMigrations.get(t);e.timer=s(),this.migrationStatus=e.lastStatus}else this.migrationStatus={messages:[`Starting ${e} migration...`],progressPct:0},i.a.post("/api/user/migrate/job/",{migrationType:e,...a}).then(e=>{this.activeMigrations.set(t,{timer:s(),taskId:e.data.taskId})}).catch(t=>{console.log(t)})},migrateProject(t){this.startMigration(t,"project",{chargeCode:t})},migrateUser(){this.startMigration("user","user")},onMigrationFinished(){this.clearPollers(),this.refresh()},clearPollers(){for(const[,t]of this.activeMigrations)t.timer&&(clearInterval(t.timer),t.timer=null)},pollMigration(t){if(!this.activeMigrations.has(t))return void console.log("No migration is running for job "+t);const e=this.activeMigrations.get(t);i.a.get("/api/user/migrate/job/?task_id="+e.taskId).then(t=>{this.migrationStatus=e.lastStatus=t.data,(this.migrationSucceeded||this.migrationFailed)&&this.onMigrationFinished()}).catch(t=>{console.log(t)})}},mounted(){this.refresh()}},p=g,m=(a("1a3f"),a("0c7c")),h=Object(m["a"])(p,u,d,!1,null,"62fcd8eb",null),f=h.exports;i.a.defaults.xsrfCookieName="csrftoken",i.a.defaults.xsrfHeaderName="X-CSRFTOKEN",i.a.defaults.transformResponse=[(t,e)=>{if(t&&e["content-type"].includes("application/json"))return n()(JSON.parse(t),{deep:!0})}],i.a.defaults.transformRequest=[(t,e)=>{const a=e["content-type"];if(t&&(!a||a.includes("application/json")))return JSON.stringify(c()(t,{deep:!0}))}],i.a.defaults.headers["Content-Type"]="application/json",new l["a"]({render:t=>t(f)}).$mount("#app")},c1e3:function(t,e,a){}});